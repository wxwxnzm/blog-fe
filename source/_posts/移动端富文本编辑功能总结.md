---
title: 移动端富文本功能技术总结(基于Eleditor)
---
##### 背景：公司微信端和app端都需要加入移动端富文本编辑功能用于留言，支持图片/视频的上传。由于都是h5实现，遇到了问题在此总结下


#### faskClick既不能触发click()也不能触发contenteditable的元素的focus
- 项目引入了faskClick以移除ios的300ms点击延迟,[Eleditor](https://github.com/Fixels/Eleditor)里上传图片是用[webuploader](https://github.com/Fixels/Eleditor/blob/master/demo/index.html#L168)实现的，在我们需要上传到阿里云的场景里不太合适，所以改写了一段源码，视频同理：
```
insertImage: function(e){
    $('.Eleditor-input-file-image').click(); // 选择文件
}
 $('.Eleditor-input-file-video').on('change', function(e){
    uploadFilesToAliyun(e.target.files, function(data) { // 上传回调
        ...
        $('.Eleditor-input-file-video').val('');
    })
})
<input type="file" accept="image/*" class="Eleditor-input-file-image">

.Eleditor-input-file-image {
    visibility: hidden;
    opacity: 0;
    width: 0;
    height: 0;
}

```
- 然后问题来了，触发insertImage方法后并不会调用input的click，但是双击却可以，调试一番发现**只要是去掉faskClick的事件后单击就有效**

##### 解决：https://blog.csdn.net/kaosini/article/details/50561263
手动给它触发两次即可，改造代码：
```
var notNeed = FastClick.notNeeded(document.body); // boolean值
$.fn.triggerFastClick=function(){
    this.trigger("click");
    if(!notNeed){
        this.trigger("click");
    }
}
$('.Eleditor-textStyle-item-upImg').on('click', function(e) {
    if (FastClick) {
        $('.Eleditor-input-file-image').triggerFastClick();
    } else { // pc兼容
        $('.Eleditor-input-file-image').click();
    }
});
```
测试发现ios和android都没问题

---
未完待续。。